#!/bin/sh
# Update your gh-pages branch based on a subdirectory of your main tree
# npm run build || exit $?
# publish-gh-pages
# Should be run on a clean working tree (all changes committed, although
# pushing is optional) with a successful and complete build.

if ! git rev-parse gh-pages >/dev/null 2>/dev/null
then
  git checkout --orphan gh-pages
  git rm -rf .
  git commit --allow-empty -m "Initialize empty gh-pages"
  git checkout master
fi
rev=`git rev-parse --short HEAD`
git add -f build
tree=`git write-tree --prefix=build/`
git reset HEAD build
commit=`echo Update gh-pages from build $rev|git commit-tree $tree -p gh-pages`
git update-ref refs/heads/gh-pages $commit
git push origin gh-pages:gh-pages
